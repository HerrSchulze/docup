<div class="upload-container">
  <!-- Main Upload Card - Creditplus.de Style -->
  <div class="card fade-in">
    <div class="card-header">
      <h3>üìÅ Dokumente hochladen</h3>
      <p>Sichere Dokumentverarbeitung mit OCR und Virenscan</p>
    </div>
    
    <div class="card-body">
      <!-- Error Messages -->
      <div *ngIf="errorMessage" class="alert alert-danger slide-up" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i> {{ errorMessage }}
      </div>

      <div *ngIf="cameraError" class="alert alert-warning slide-up" role="alert">
        <i class="fas fa-camera me-2"></i> {{ cameraError }}
      </div>

      <!-- Action Buttons -->
      <div class="row mb-4" *ngIf="!isUploading">
        <div class="col-md-6 mb-3">
          <button 
            class="btn btn-outline-primary btn-lg w-100"
            (click)="startCamera()"
            [disabled]="isCameraActive">
            <i class="fas fa-camera me-2"></i> Foto aufnehmen
          </button>
        </div>
        <div class="col-md-6 mb-3">
          <button 
            class="btn btn-primary btn-lg w-100"
            (click)="fileInput.click()">
            <i class="fas fa-upload me-2"></i> Dateien ausw√§hlen
          </button>
        </div>
      </div>

      <!-- Camera Section -->
      <div class="camera-section slide-up" *ngIf="isCameraActive">
        <h5><i class="fas fa-camera me-2"></i> Kamera aktiv</h5>
        <div class="text-center">
          <video #videoElement autoplay playsinline class="camera-video mb-3"></video>
          <div class="camera-controls">
            <button class="btn btn-success btn-lg me-2" (click)="capturePhoto()">
              <i class="fas fa-circle me-2"></i> Aufnehmen
            </button>
            <button class="btn btn-outline-secondary btn-lg" (click)="stopCamera()">
              <i class="fas fa-times me-2"></i> Abbrechen
            </button>
          </div>
        </div>
      </div>
      </div>

      <!-- Hidden File Input -->
      <input 
        #fileInput
        type="file" 
        class="d-none"
        multiple
        accept="image/*,.pdf"
        (change)="onFileSelected($event)">

      <!-- Drag & Drop Area -->
      <div 
        class="drop-zone slide-up"
        [class.drag-over]="isDragOver"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
        (click)="fileInput.click()"
        *ngIf="!isUploading && !isCameraActive">
        
        <div class="drop-zone-content">
          <i class="fas fa-cloud-upload-alt"></i>
          <h4>Dateien hierher ziehen</h4>
          <p>oder klicken zum Durchsuchen</p>
          <div class="file-types">
            <strong>Unterst√ºtzte Formate:</strong> JPG, PNG, PDF<br>
            <strong>Maximale Gr√∂√üe:</strong> 50MB pro Datei
          </div>
        </div>
      </div>

      <!-- Selected Files Preview -->
      <div *ngIf="selectedFiles.length > 0" class="selected-files slide-up">
        <h5><i class="fas fa-file-alt me-2"></i>Ausgew√§hlte Dateien ({{ selectedFiles.length }})</h5>
        <div class="row">
          <div class="col-lg-6" *ngFor="let filePreview of selectedFiles; let i = index">
            <div class="file-preview-card fade-in">
              <div class="file-preview-header">
                <div>
                  <div class="file-name">{{ filePreview.metadata.name }}</div>
                  <div class="file-size">{{ formatFileSize(filePreview.metadata.size) }}</div>
                </div>
                <button 
                  class="btn btn-sm btn-outline-danger"
                  (click)="removeFile(i)"
                  title="Datei entfernen">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              
              <!-- Image Preview -->
              <div *ngIf="filePreview.preview" class="file-preview-image">
                <img [src]="filePreview.preview" alt="Preview" class="img-fluid">
              </div>
              
              <!-- PDF Preview -->
              <div *ngIf="!filePreview.preview && filePreview.metadata.type === 'application/pdf'" 
                   class="file-preview-pdf">
                <i class="fas fa-file-pdf"></i>
                <p><strong>PDF-Dokument</strong></p>
                <small>Vorschau nach dem Upload verf√ºgbar</small>
              </div>

              <!-- File Info -->
              <div class="file-info">
                <div class="file-info-item">
                  <span class="file-info-label">Typ:</span>
                  <span class="file-info-value">{{ getFileTypeDisplay(filePreview.metadata.type) }}</span>
                </div>
                <div class="file-info-item">
                  <span class="file-info-label">Gr√∂√üe:</span>
                  <span class="file-info-value">{{ formatFileSize(filePreview.metadata.size) }}</span>
                </div>
                <div class="file-info-item">
                  <span class="file-info-label">Status:</span>
                  <span class="file-info-value">
                    <span class="badge badge-primary">Bereit zum Upload</span>
                  </span>
                </div>
              </div>

              <!-- OCR Preview -->
              <div *ngIf="filePreview.ocrText" class="ocr-preview">
                <h6><i class="fas fa-eye me-2"></i>OCR Vorschau</h6>
                <div class="ocr-text">{{ filePreview.ocrText }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Upload Button -->
        <div class="text-center mt-4" *ngIf="selectedFiles.length > 0 && !isUploading">
          <button 
            class="btn btn-success btn-lg px-5"
            (click)="uploadFiles()">
            <i class="fas fa-upload me-2"></i>
            {{ selectedFiles.length === 1 ? 'Datei hochladen' : selectedFiles.length + ' Dateien hochladen' }}
          </button>
        </div>
      </div>

      <!-- Upload Progress -->
      <div *ngIf="isUploading" class="upload-progress slide-up">
        <h6><i class="fas fa-spinner fa-spin me-2"></i>Upload l√§uft...</h6>
        <div class="progress">
          <div 
            class="progress-bar" 
            role="progressbar" 
            [style.width.%]="uploadProgress"
            [attr.aria-valuenow]="uploadProgress" 
            aria-valuemin="0" 
            aria-valuemax="100">
          </div>
        </div>
        <div class="upload-status">
          {{ uploadProgress }}% abgeschlossen
        </div>
      </div>

      <!-- Upload Results -->
      <div *ngIf="uploadResults.length > 0" class="upload-results slide-up">
        <h5><i class="fas fa-check-circle me-2 text-success"></i>Upload-Ergebnisse</h5>
        <div *ngFor="let result of uploadResults" class="file-preview-card">
          <div class="file-preview-header">
            <div>
              <div class="file-name">{{ result.filename }}</div>
              <div class="file-size">{{ formatFileSize(result.size) }}</div>
            </div>
            <span class="badge badge-success">
              <i class="fas fa-check me-1"></i>Erfolgreich
            </span>
          </div>

          <!-- OCR Results -->
          <div *ngIf="result.ocrText" class="ocr-preview">
            <h6><i class="fas fa-text-width me-2"></i>Extrahierter Text</h6>
            <div class="ocr-text">{{ result.ocrText }}</div>
          </div>

          <!-- File Details -->
          <div class="file-info">
            <div class="file-info-item">
              <span class="file-info-label">Upload-Zeit:</span>
              <span class="file-info-value">{{ formatDate(result.uploadedAt) }}</span>
            </div>
            <div class="file-info-item">
              <span class="file-info-label">Virenscan:</span>
              <span class="file-info-value">
                <span [class]="result.virusScanPassed ? 'badge badge-success' : 'badge badge-danger'">
                  <i [class]="result.virusScanPassed ? 'fas fa-shield-alt' : 'fas fa-exclamation-triangle'" class="me-1"></i>
                  {{ result.virusScanPassed ? 'Sauber' : 'Virus erkannt' }}
                </span>
              </span>
            </div>
            <div class="file-info-item">
              <span class="file-info-label">Speicherort:</span>
              <span class="file-info-value">{{ result.storagePath }}</span>
            </div>
          </div>
        </div>

        <!-- Reset Button -->
        <div class="text-center mt-4">
          <button 
            class="btn btn-outline-primary btn-lg"
            (click)="resetUpload()">
            <i class="fas fa-redo me-2"></i>Weitere Dateien hochladen
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
                <img [src]="filePreview.preview" alt="Preview" class="img-fluid">
              </div>
              
              <!-- PDF Icon -->
              <div *ngIf="!filePreview.preview && filePreview.file.type === 'application/pdf'" 
                   class="file-preview-pdf">
                <i class="fas fa-file-pdf fa-4x text-danger"></i>
                <p>PDF Document</p>
              </div>

              <!-- File Info -->
              <div class="file-info">
                <small class="text-muted">
                  {{ formatFileSize(filePreview.metadata.size) }} ‚Ä¢ {{ filePreview.metadata.type }}
                </small>
              </div>

              <!-- OCR Preview -->
              <div *ngIf="filePreview.ocrText" class="ocr-preview">
                <h6>OCR Preview:</h6>
                <div class="ocr-text">
                  {{ filePreview.ocrText | slice:0:200 }}
                  <span *ngIf="filePreview.ocrText.length > 200">...</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Upload Progress -->
      <div *ngIf="isUploading" class="upload-progress mb-4">
        <h5>{{ uploadProgress.message }}</h5>
        <div class="progress mb-2">
          <div 
            class="progress-bar progress-bar-striped progress-bar-animated"
            [class.bg-success]="uploadProgress.status === 'completed'"
            [class.bg-primary]="uploadProgress.status === 'uploading'"
            [class.bg-warning]="uploadProgress.status === 'processing'"
            [style.width.%]="uploadProgress.progress">
          </div>
        </div>
        <small class="text-muted">{{ uploadProgress.progress }}% complete</small>
      </div>

      <!-- Upload Result -->
      <div *ngIf="uploadResult" class="upload-result">
        <div class="alert alert-success">
          <h5><i class="fas fa-check-circle"></i> Upload Successful!</h5>
          <div class="result-details">
            <p><strong>Filename:</strong> {{ uploadResult.filename }}</p>
            <p><strong>Size:</strong> {{ formatFileSize(uploadResult.size) }}</p>
            <p><strong>Type:</strong> {{ uploadResult.mimeType }}</p>
            <p><strong>Uploaded:</strong> {{ uploadResult.uploadedAt | date:'medium' }}</p>
            <p><strong>Virus Scan:</strong> 
              <span [class]="uploadResult.virusScanPassed ? 'text-success' : 'text-danger'">
                {{ uploadResult.virusScanPassed ? '‚úì Passed' : '‚úó Failed' }}
              </span>
            </p>
            
            <!-- OCR Results -->
            <div *ngIf="uploadResult.ocrText" class="ocr-results mt-3">
              <h6>Extracted Text:</h6>
              <div class="ocr-text-result">
                {{ uploadResult.ocrText }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button 
          *ngIf="selectedFiles.length > 0 && !isUploading"
          class="btn btn-primary btn-lg me-2"
          (click)="uploadFiles()">
          <i class="fas fa-upload"></i> Upload Files
        </button>
        
        <button 
          class="btn btn-outline-secondary"
          (click)="clearAll()">
          <i class="fas fa-refresh"></i> Clear All
        </button>
      </div>
    </div>
  </div>
</div>
