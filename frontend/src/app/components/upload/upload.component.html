<div class="upload-container">
  <!-- Main Upload Card - Creditplus.de Style -->
  <div class="card fade-in">
    <div class="card-header">
      <h3>üìÅ Dokumente hochladen</h3>
      <p>Sichere Dokumentverarbeitung mit OCR und Virenscan</p>
    </div>
    
    <div class="card-body">
      <!-- Error Messages -->
      <div *ngIf="errorMessage" class="alert alert-danger slide-up" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i> {{ errorMessage }}
      </div>

      <div *ngIf="cameraError" class="alert alert-warning slide-up" role="alert">
        <i class="fas fa-camera me-2"></i> {{ cameraError }}
      </div>

      <!-- Action Buttons -->
      <div class="row mb-4" *ngIf="!isUploading">
        <div class="col-md-6 mb-3">
          <button 
            class="btn btn-outline-primary btn-lg w-100"
            (click)="startCamera()"
            [disabled]="isCameraActive">
            <i class="fas fa-camera me-2"></i> Foto aufnehmen
          </button>
        </div>
        <div class="col-md-6 mb-3">
          <button 
            class="btn btn-primary btn-lg w-100"
            (click)="fileInput.click()">
            <i class="fas fa-upload me-2"></i> Dateien ausw√§hlen
          </button>
        </div>
      </div>

      <!-- Camera Section -->
      <div class="camera-section slide-up" *ngIf="isCameraActive">
        <h5><i class="fas fa-camera me-2"></i> Kamera aktiv</h5>
        <div class="text-center">
          <video #videoElement autoplay playsinline class="camera-video mb-3"></video>
          <div class="camera-controls">
            <button class="btn btn-success btn-lg me-2" (click)="capturePhoto()">
              <i class="fas fa-circle me-2"></i> Aufnehmen
            </button>
            <button class="btn btn-outline-secondary btn-lg" (click)="stopCamera()">
              <i class="fas fa-times me-2"></i> Abbrechen
            </button>
          </div>
        </div>
      </div>

      <!-- Hidden File Input -->
      <input 
        #fileInput
        type="file" 
        class="d-none"
        multiple
        accept="image/*,.pdf"
        (change)="onFileSelected($event)">

      <!-- Drag & Drop Area -->
      <div 
        class="drop-zone slide-up"
        [class.drag-over]="isDragOver"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
        (click)="fileInput.click()"
        *ngIf="!isUploading && !isCameraActive">
        
        <div class="drop-zone-content">
          <i class="fas fa-cloud-upload-alt"></i>
          <h4>Dateien hierher ziehen</h4>
          <p>oder klicken zum Durchsuchen</p>
          <div class="file-types">
            <strong>Unterst√ºtzte Formate:</strong> JPG, PNG, PDF<br>
            <strong>Maximale Gr√∂√üe:</strong> 50MB pro Datei
          </div>
        </div>
      </div>

      <!-- Selected Files Preview -->
      <div *ngIf="selectedFiles.length > 0" class="selected-files slide-up">
        <h5><i class="fas fa-file-alt me-2"></i>Ausgew√§hlte Dateien ({{ selectedFiles.length }})</h5>
        <div class="row">
          <div class="col-lg-6" *ngFor="let filePreview of selectedFiles; let i = index">
            <div class="file-preview-card fade-in">
              <div class="file-preview-header">
                <div>
                  <div class="file-name">{{ filePreview.metadata.name }}</div>
                  <div class="file-size">{{ formatFileSize(filePreview.metadata.size) }}</div>
                </div>
                <button 
                  class="btn btn-sm btn-outline-danger"
                  (click)="removeFile(i)"
                  title="Datei entfernen">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              
              <!-- Image Preview -->
              <div *ngIf="filePreview.preview" class="file-preview-image">
                <img [src]="filePreview.preview" alt="Preview" class="img-fluid">
              </div>
              
              <!-- PDF Preview -->
              <div *ngIf="!filePreview.preview && filePreview.metadata.type === 'application/pdf'" 
                   class="file-preview-pdf">
                <i class="fas fa-file-pdf"></i>
                <p><strong>PDF-Dokument</strong></p>
                <small>Vorschau nach dem Upload verf√ºgbar</small>
              </div>

              <!-- File Info -->
              <div class="file-info">
                <div class="file-info-item">
                  <span class="file-info-label">Typ:</span>
                  <span class="file-info-value">{{ getFileTypeDisplay(filePreview.metadata.type) }}</span>
                </div>
                <div class="file-info-item">
                  <span class="file-info-label">Gr√∂√üe:</span>
                  <span class="file-info-value">{{ formatFileSize(filePreview.metadata.size) }}</span>
                </div>
                <div class="file-info-item">
                  <span class="file-info-label">Status:</span>
                  <span class="file-info-value">
                    <span class="badge badge-primary">Bereit zum Upload</span>
                  </span>
                </div>
              </div>

              <!-- OCR Preview -->
              <div *ngIf="filePreview.ocrText" class="ocr-preview">
                <h6><i class="fas fa-eye me-2"></i>OCR Vorschau</h6>
                <div class="ocr-text">{{ filePreview.ocrText }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Upload Button -->
        <div class="text-center mt-4" *ngIf="selectedFiles.length > 0 && !isUploading">
          <button 
            class="btn btn-success btn-lg px-5"
            (click)="uploadFiles()">
            <i class="fas fa-upload me-2"></i>
            {{ selectedFiles.length === 1 ? 'Datei hochladen' : selectedFiles.length + ' Dateien hochladen' }}
          </button>
        </div>
      </div>

      <!-- Enhanced Upload Progress -->
      <div *ngIf="isUploading" class="upload-progress slide-up">
        <div class="progress-header">
          <h6>
            <i class="fas fa-spinner fa-spin me-2"></i>
            {{ currentProgressStatus || 'Upload l√§uft...' }}
          </h6>
          <span class="progress-percentage">{{ uploadProgress }}%</span>
        </div>
        
        <div class="progress mb-3">
          <div 
            class="progress-bar progress-bar-striped progress-bar-animated" 
            [class]="'progress-bar-' + currentProgressPhase"
            role="progressbar" 
            [style.width.%]="uploadProgress"
            [attr.aria-valuenow]="uploadProgress" 
            aria-valuemin="0" 
            aria-valuemax="100">
          </div>
        </div>
        
        <div class="progress-details">
          <div class="progress-message">
            <i class="fas fa-info-circle me-1" aria-hidden="true"></i>
            <span>{{ currentProgressMessage || 'Verarbeitung l√§uft...' }}</span>
          </div>
          <div *ngIf="estimatedTimeRemaining" class="time-remaining">
            <i class="fas fa-clock me-1" aria-hidden="true"></i>
            <span>Noch ca. {{ formatTime(estimatedTimeRemaining) }}</span>
          </div>
        </div>
        
        <!-- Phase Indicators -->
        <div class="phase-indicators mt-3" role="progressbar" 
             [attr.aria-label]="'Upload Phase: ' + currentProgressPhase"
             [attr.aria-valuenow]="uploadProgress"
             aria-valuemin="0" 
             aria-valuemax="100">
          <div class="phase" 
               [class.active]="currentProgressPhase === 'preparing'" 
               [class.complete]="uploadProgress > 5"
               [attr.aria-current]="currentProgressPhase === 'preparing' ? 'step' : null">
            <i class="fas fa-cog" aria-hidden="true"></i>
            <span>Vorbereitung</span>
          </div>
          <div class="phase" 
               [class.active]="currentProgressPhase === 'uploading'" 
               [class.complete]="uploadProgress > 30"
               [attr.aria-current]="currentProgressPhase === 'uploading' ? 'step' : null">
            <i class="fas fa-cloud-upload-alt" aria-hidden="true"></i>
            <span>Upload</span>
          </div>
          <div class="phase" 
               [class.active]="currentProgressPhase === 'virus-scan'" 
               [class.complete]="uploadProgress > 50"
               [attr.aria-current]="currentProgressPhase === 'virus-scan' ? 'step' : null">
            <i class="fas fa-shield-alt" aria-hidden="true"></i>
            <span>Virenpr√ºfung</span>
          </div>
          <div class="phase" 
               [class.active]="currentProgressPhase === 'ocr-processing'" 
               [class.complete]="uploadProgress >= 100"
               [attr.aria-current]="currentProgressPhase === 'ocr-processing' ? 'step' : null">
            <i class="fas fa-eye" aria-hidden="true"></i>
            <span>Texterkennung</span>
          </div>
        </div>
      </div>

      <!-- Upload Results -->
      <div *ngIf="uploadResults.length > 0" class="upload-results slide-up">
        <h5><i class="fas fa-check-circle me-2 text-success"></i>Upload-Ergebnisse</h5>
        <div *ngFor="let result of uploadResults" class="file-preview-card">
          <div class="file-preview-header">
            <div>
              <div class="file-name">{{ result.filename }}</div>
              <div class="file-size">{{ formatFileSize(result.size) }}</div>
            </div>
            <span class="badge badge-success">
              <i class="fas fa-check me-1"></i>Erfolgreich
            </span>
          </div>

          <!-- OCR Results -->
          <div *ngIf="result.ocrText" class="ocr-preview">
            <h6><i class="fas fa-text-width me-2"></i>Extrahierter Text</h6>
            <div class="ocr-text">{{ result.ocrText }}</div>
          </div>

          <!-- File Details -->
          <div class="file-info">
            <div class="file-info-item">
              <span class="file-info-label">Upload-Zeit:</span>
              <span class="file-info-value">{{ formatDate(result.uploadedAt) }}</span>
            </div>
            <div class="file-info-item">
              <span class="file-info-label">Virenscan:</span>
              <span class="file-info-value">
                <span [class]="result.virusScanPassed ? 'badge badge-success' : 'badge badge-danger'">
                  <i [class]="result.virusScanPassed ? 'fas fa-shield-alt' : 'fas fa-exclamation-triangle'" class="me-1"></i>
                  {{ result.virusScanPassed ? 'Sauber' : 'Virus erkannt' }}
                </span>
              </span>
            </div>
            <div class="file-info-item">
              <span class="file-info-label">Speicherort:</span>
              <span class="file-info-value">{{ result.storagePath }}</span>
            </div>
          </div>
        </div>

        <!-- Reset Button -->
        <div class="text-center mt-4">
          <button 
            class="btn btn-outline-primary btn-lg"
            (click)="resetUpload()">
            <i class="fas fa-redo me-2"></i>Weitere Dateien hochladen
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
